{% extends "layouts/base.html" %}
{% load static %}
{% block title %} PO Invoice List {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
  <style>
    .myFileInput {
        display: none;
    }
  </style>
{% endblock stylesheets %}
{% block head %}

  <script src="{% static 'assets/js/datatable_ajax.js' %}"></script>
  <link rel="stylesheet" href="{% static 'assets/css/datatable.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
  <script src="{% static 'assets/js/datatable_1.js' %}"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
  <script src="{% static 'assets/js/datatable.js' %}"></script>

{% endblock head %}

{% block content %}
<div class="topbar_pages px-4 py-1">
  <h5 class="font-weight-bolder mb-0">Submitted Invoices</h5>
  <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
        <li class="breadcrumb-item text-sm"><a href="{% url 'wayrem_supplier:supplier_profile' %}"><span class="sidebar-icon"><span class="fas fa-chart-pie"></span></span> Dashboard</a></li>
        <li class="breadcrumb-item text-sm"><a href="{% url 'wayrem_supplier:invoicelist' %}"><span class="sidebar-icon"><span class="fas fa-chart-pie"></span></span> All invoices</a></li>
        <li class="breadcrumb-item active text-sm" aria-current="page">Create Submitted Invoices</li>
      </ol>
  </nav>
</div>
<div class="subheader row mt-5">
  <div class="add_btn col-xl-7 col-lg-7 col-md-7">
    <div class="col-5">
      <div class="dropdown">               
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
          <li><a class="dropdown-item" href="#">export to pdf</a></li>
          <li><a class="dropdown-item" href="#">export to excel</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="col-xl-5 col-lg-5 px-0 py-3">
      <div class="row d-flex align-items-right">                                                                                                        
          <div class="col-xl-6 col-lg-6 col-md-6 px-2">
          </div>
          <div class="col-xl-6 col-lg-6 col-md-6" style="height:40px;">
            <div class="input-group table_shadow">
                <span class="input-group-text text-body"><i aria-hidden="true" class="fas fa-search"></i></span>
                <input class="form-control product_search" placeholder="Search" type="search" id="table_search">
            </div>
        </div>
      </div>
  </div>
</div>
{% if messages %}
  {% for message in messages %}
    <div {% if message.tags %} class="alert alert-{{message.tags}} alert-dismissible fade show" {% endif %} role="alert">
      <strong> {{ message }}!</strong>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}
<div class="card mb-4">
  <div class="card-body px-0 pt-0 pb-2">
      <div class="table-responsive p-3">
        <table class="table align-items-center mb-0" id="filtertable">
          <thead>
              <tr>
                <th class="text-secondary text-sm font-weight-bolder opacity-7">Purchase Order</th>   
                <th class="text-secondary text-sm font-weight-bolder opacity-7">Date</th>
                {% comment %} <th class="text-secondary text-sm font-weight-bolder opacity-7">Status</th> {% endcomment %}
                <th class="text-secondary text-sm font-weight-bolder opacity-7">Invoice</th>
              </tr>
          </thead>
          <tbody>
            {% for item1 in poinvoicelist %}
              <tr>
                <td class="text-sm font-weight-bold p-4">
                  <h6>{{item1.2}}</h6>
                </td>   
                <td class="text-sm font-weight-bold p-4">{{item1.7|date:"d M Y  h:i a"}}</td>  
                {% comment %} <td class="text-sm font-weight-bold p-4">{{item1.6}}</td>                       {% endcomment %}
                <td class="text-sm font-weight-bold p-4"> 
                  <div class="col">
                    <form method="POST" action="{% url 'wayrem_supplier:uploadinvoice' %}" enctype="multipart/form-data" >
                      {% csrf_token %}
                      <input type="hidden" name="po_name" value="{{item1.2}}" />
                      <input type="file" class="myFileInput" name="myFileInput" accept="application/pdf" onchange="form.submit()" id="myFileInput{{forloop.counter}}" />
                    </form>
                    <a type="button" class="upload-invoice" title="Upload Invoice" status="{{item1.6}}" clickid="myFileInput{{forloop.counter}}" value="Upload Invoice" data-id="{{item1.2}}">
                      <i class="p-2 fas fa-file-upload edit_action_btn" aria-hidden="true"></i>
                    </a>
                  </div>            
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        <nav class= "pt-3" aria-label="...">
          <ul class="pagination">
            <li class="page-item {% if not poinvoicelist.has_previous %}disabled{% endif %}">
              <a class="page-link" {% if poinvoicelist.has_previous %} href="?page={{ poinvoicelist.previous_page_number }}"  {% endif %}>Previous</a>
            </li>
            {% if poinvoicelist.number|add:'-4' > 1 %}
              <li class="page-item"><a class="page-link" href="?page={{ poinvoicelist.number|add:'-5' }}">&hellip;</a></li>
            {% endif %}
    
            {% for num in poinvoicelist.paginator.page_range %}
              {% if num == poinvoicelist.number %}
                <li class="page-item active" aria-current="page">
                  <a class="page-link" href="#">{{ num }}</a>
                </li>
              {% elif num > poinvoicelist.number|add:'-5' and num < poinvoicelist.number|add:'5' %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %} 
            {% endfor %}
    
            {% if poinvoicelist.paginator.num_pages > poinvoicelist.number|add:'4' %}
                <li class="page-item"><a class="page-link" href="?page={{ poinvoicelist.number|add:'5' }}">&hellip;</a></li>
            {% endif %}
    
            <li class="page-item {% if not poinvoicelist.has_next %}disabled{% endif %}">
              <a class="page-link" {% if poinvoicelist.has_next %} href="?page={{ poinvoicelist.next_page_number }}" {% endif %}>Next</a>
            </li>
          </ul>
        </nav>
        <hr>
        <div class="text-right">
          <a href="{% url 'wayrem_supplier:invoicelist' %}" class="btn btn-dark my-3" >Back</a>
        </div>
      </div>
    </div>
</div>        


<script>
  $(document).ready(function () {
      oTable = $('#filtertable').DataTable({
          dom: 'rtip',
          'columnDefs': [{ 'orderable': false, 'targets': [2] }],
          // "oLanguage": {
          //     "oPaginate": {
          //         "sNext": '<i class="fas fa-arrow-circle-right text-primary"></i>',
          //         "sPrevious": '<i class="fas fa-arrow-circle-left text-primary"></i>'
          //     }
          // },
          "fnDrawCallback": function (oSettings) {
              if (oSettings._iDisplayLength > oSettings.fnRecordsDisplay()) {
                  $(oSettings.nTableWrapper).find('.dataTables_paginate').hide();
              } else {
                  $(oSettings.nTableWrapper).find('.dataTables_paginate').show();
              }
          }
      });
      $('#table_search').keyup(function () {
          oTable.search($(this).val()).draw();
      })
      $("#table_search").on(
        "change keyup paste input", function() {
         oTable.search($(this).val()).draw();
      })
  });
</script> 
<script>
  $('.upload-invoice').click(function(e){
    e.preventDefault();
    var acceptchk = $(this).attr('clickid');
    if($(this).attr('status') == 'waiting for approval'){
      $('.uploaderror.errortable').remove();
        $(this).after('<span class="uploaderror errortable">Please accept before raise invoice.</span>');
    }
    else if($(this).attr('status') == 'declined'){
      $('.uploaderror.errortable').remove();
        $(this).after('<span class="uploaderror errortable">Already declined this Purchase Order.</span>');
    }
    else{
      $('#'+acceptchk).click();
    }
    setTimeout(function(){
      $('.uploaderror.errortable').remove();
      }, 6000);
  });
</script>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}{% endblock javascripts %}